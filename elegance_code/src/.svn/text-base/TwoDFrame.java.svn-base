
import java.io.File;
import java.text.SimpleDateFormat;
import java.util.Calendar;
import javax.imageio.ImageIO;
import javax.swing.JOptionPane;

/*
 * To change this template, choose Tools | Templates
 * and open the template in the editor.
 */

/*
 * TwoDFrame.java
 *
 * Created on Nov 15, 2010, 1:45:56 PM
 */
/**
 *
 * @author mxu
 */
public class TwoDFrame extends javax.swing.JFrame {

    /** Creates new form TwoDFrame */
    public TwoDFrame() {


        initComponents();
    }

    /** This method is called from within the constructor to
     * initialize the form.
     * WARNING: Do NOT modify this code. The content of this method is
     * always regenerated by the Form Editor.
     */
    @SuppressWarnings("unchecked")
    // <editor-fold defaultstate="collapsed" desc="Generated Code">//GEN-BEGIN:initComponents
    private void initComponents() {

        viewAngle = new javax.swing.ButtonGroup();
        neuronsLabel = new javax.swing.JLabel();
        neuronsBox = new javax.swing.JTextField();
        partnerLabel = new javax.swing.JLabel();
        partnersBox = new javax.swing.JTextField();
        inBox = new javax.swing.JCheckBox();
        outBox = new javax.swing.JCheckBox();
        javax.swing.JLabel showLabel = new javax.swing.JLabel();
        electricalBox = new javax.swing.JCheckBox();
        viewLabel = new javax.swing.JLabel();
        generateButton = new javax.swing.JButton();
        cancelButton = new javax.swing.JButton();
        backboneBox = new javax.swing.JCheckBox();
        javax.swing.JRadioButton yzButton = new javax.swing.JRadioButton();
        xzButton = new javax.swing.JRadioButton();
        spacingLabel = new javax.swing.JLabel();
        spacingBox = new javax.swing.JTextField();
        zoomLabel = new javax.swing.JLabel();
        zoomBox = new javax.swing.JTextField();

        setDefaultCloseOperation(javax.swing.WindowConstants.EXIT_ON_CLOSE);
        setTitle("2D diagram");
        setAlwaysOnTop(true);

        neuronsLabel.setFont(new java.awt.Font("Ubuntu", 1, 15));
        neuronsLabel.setText("Pleas enter the neuron name or contin#:");
        neuronsLabel.setName("labelNeuron"); // NOI18N
        neuronsLabel.setOpaque(true);

        partnerLabel.setFont(new java.awt.Font("Ubuntu", 1, 15));
        partnerLabel.setText("Partners to show (empty means all): ");

        inBox.setSelected(true);
        inBox.setText("chemical (presynaptic, out)");

        outBox.setSelected(true);
        outBox.setText("chemical (postsynaptic, in)");

        showLabel.setFont(new java.awt.Font("Ubuntu", 1, 15));
        showLabel.setText("Components to show:");

        electricalBox.setSelected(true);
        electricalBox.setText("gap junction");

        viewLabel.setFont(new java.awt.Font("Ubuntu", 1, 15)); // NOI18N
        viewLabel.setText("View angle:");

        generateButton.setText("Generate 2D diagram");
        generateButton.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                generateButtonActionPerformed(evt);
            }
        });

        cancelButton.setText("Cancel");
        cancelButton.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                cancelButtonActionPerformed(evt);
            }
        });

        backboneBox.setSelected(true);
        backboneBox.setText("backbone");

        viewAngle.add(yzButton);
        yzButton.setSelected(true);
        yzButton.setText("side view Y_Z");

        viewAngle.add(xzButton);
        xzButton.setText("top view X_Z");

        spacingLabel.setFont(new java.awt.Font("Ubuntu", 1, 15)); // NOI18N
        spacingLabel.setText("Section spacing (pixel): ");

        spacingBox.setText("1.00");

        zoomLabel.setFont(new java.awt.Font("Ubuntu", 1, 15)); // NOI18N
        zoomLabel.setText("Zoom:");

        zoomBox.setText("1.00");

        javax.swing.GroupLayout layout = new javax.swing.GroupLayout(getContentPane());
        getContentPane().setLayout(layout);
        layout.setHorizontalGroup(
            layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(layout.createSequentialGroup()
                .addContainerGap()
                .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addGroup(javax.swing.GroupLayout.Alignment.TRAILING, layout.createSequentialGroup()
                        .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.TRAILING)
                            .addGroup(layout.createSequentialGroup()
                                .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                                    .addComponent(showLabel)
                                    .addComponent(spacingLabel))
                                .addGap(83, 83, 83)
                                .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                                    .addComponent(outBox)
                                    .addGroup(javax.swing.GroupLayout.Alignment.TRAILING, layout.createSequentialGroup()
                                        .addComponent(backboneBox)
                                        .addGap(81, 81, 81)
                                        .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                                            .addComponent(xzButton)
                                            .addComponent(electricalBox)
                                            .addComponent(neuronsBox, javax.swing.GroupLayout.DEFAULT_SIZE, 180, Short.MAX_VALUE)
                                            .addComponent(partnersBox, javax.swing.GroupLayout.DEFAULT_SIZE, 180, Short.MAX_VALUE))
                                        .addGap(70, 70, 70))
                                    .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.TRAILING, false)
                                        .addComponent(zoomBox, javax.swing.GroupLayout.Alignment.LEADING)
                                        .addComponent(spacingBox, javax.swing.GroupLayout.Alignment.LEADING, javax.swing.GroupLayout.DEFAULT_SIZE, 180, Short.MAX_VALUE))))
                            .addComponent(neuronsLabel, javax.swing.GroupLayout.Alignment.LEADING)
                            .addComponent(partnerLabel, javax.swing.GroupLayout.Alignment.LEADING)
                            .addGroup(javax.swing.GroupLayout.Alignment.LEADING, layout.createSequentialGroup()
                                .addComponent(viewLabel)
                                .addGap(166, 166, 166)
                                .addComponent(yzButton)))
                        .addGap(31, 31, 31))
                    .addGroup(layout.createSequentialGroup()
                        .addComponent(inBox)
                        .addContainerGap())))
            .addGroup(layout.createSequentialGroup()
                .addGap(124, 124, 124)
                .addComponent(generateButton)
                .addGap(82, 82, 82)
                .addComponent(cancelButton)
                .addContainerGap(294, Short.MAX_VALUE))
            .addGroup(layout.createSequentialGroup()
                .addContainerGap()
                .addComponent(zoomLabel)
                .addContainerGap(666, Short.MAX_VALUE))
        );
        layout.setVerticalGroup(
            layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(layout.createSequentialGroup()
                .addGap(28, 28, 28)
                .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.TRAILING)
                    .addComponent(neuronsLabel)
                    .addGroup(layout.createSequentialGroup()
                        .addComponent(neuronsBox, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED)))
                .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addGroup(layout.createSequentialGroup()
                        .addGap(18, 18, 18)
                        .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                            .addComponent(viewLabel)
                            .addComponent(yzButton)))
                    .addGroup(layout.createSequentialGroup()
                        .addGap(9, 9, 9)
                        .addComponent(xzButton)))
                .addGap(18, 18, 18)
                .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addComponent(partnerLabel, javax.swing.GroupLayout.PREFERRED_SIZE, 26, javax.swing.GroupLayout.PREFERRED_SIZE)
                    .addComponent(partnersBox, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))
                .addGap(19, 19, 19)
                .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(showLabel)
                    .addComponent(backboneBox)
                    .addComponent(electricalBox))
                .addGap(27, 27, 27)
                .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(inBox)
                    .addComponent(outBox))
                .addGap(18, 18, 18)
                .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(spacingBox, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                    .addComponent(spacingLabel, javax.swing.GroupLayout.PREFERRED_SIZE, 34, javax.swing.GroupLayout.PREFERRED_SIZE))
                .addGap(18, 18, 18)
                .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(zoomLabel)
                    .addComponent(zoomBox, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED, 58, Short.MAX_VALUE)
                .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(generateButton)
                    .addComponent(cancelButton))
                .addGap(50, 50, 50))
        );

        pack();
    }// </editor-fold>//GEN-END:initComponents

    private void generateButtonActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_generateButtonActionPerformed

        String[] neurons = neuronsBox.getText().split(",");
        String[] showPartners = partnersBox.getText().split(",");
        float spacing = Float.parseFloat(spacingBox.getText());
        float zoom = Float.parseFloat(zoomBox.getText());
        int showIn = 0;
        int showOut = 0;
        int showBackbone = 0;
        int showElectrical = 0;
        String dtype = "Y_Z";

        int[] showContins = new int[neurons.length];
        for (int i = 0; i < neurons.length; i++) {

            neurons[i] = Utilities.getNumberFromWhatever(neurons[i]);
            showContins[i] = Integer.parseInt(neurons[i]);
        }
       

        if (inBox.isSelected()) {
            showIn = 1;
        }
        if (outBox.isSelected()) {
            showOut = 1;
        }
        
        if (electricalBox.isSelected()) {
            showElectrical = 1;
        }
        if (backboneBox.isSelected()) {
            showBackbone = 1;
        }
        if (xzButton.isSelected()){
        dtype="X_Z";
        }

 System.out.println(showContins[0] + " " + showPartners[0] + " " + showIn + " " + showOut +  " " + showElectrical + " " + showBackbone + " " + spacing+" "+zoom+" "+dtype);


        createImageFile(showContins, showPartners, dtype, showIn,  showOut,  showElectrical, showBackbone, spacing, zoom);

    }//GEN-LAST:event_generateButtonActionPerformed

    private void cancelButtonActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_cancelButtonActionPerformed
        // TODO add your handling code here:
        this.dispose();
    }//GEN-LAST:event_cancelButtonActionPerformed

    /**
     * @param args the command line arguments
     */
    public static void main(String args[]) {
        java.awt.EventQueue.invokeLater(new Runnable() {

            public void run() {
                new TwoDFrame().setVisible(true);
            }
        });
    }

    public static String now() {
        Calendar cal = Calendar.getInstance();
        SimpleDateFormat sdf = new SimpleDateFormat("yyyy_MM_dd_HH_mm_ss");
        return sdf.format(cal.getTime());

    }

    public static void createImageFile(int[] showContins, String[] showPartners, String dtype, int showIn, int showOut, int showElectrical, int showBackbone, float spacing, float zoom) {

        try {
            New2D g = new New2D(showContins, showPartners, dtype, showIn, showOut, showElectrical, showBackbone, spacing, zoom);

            //System.out.println(g.width+"    "+g.height);
            String filePath = "." + File.separator + "images" + File.separator + g.continName + "X" + zoom + "_" + dtype + "_" + now() + ".png";
            File imgFile = new File(filePath);
            java.io.FileOutputStream out = new java.io.FileOutputStream(imgFile);
            ImageIO.write(g.getBufferedImage(), "png", out);
            out.flush();
            out.close();

            ImageViewer im = new ImageViewer(filePath);
            im.setVisible(true);

        } catch (Exception e) {
            e.printStackTrace();
        }

    }
    // Variables declaration - do not modify//GEN-BEGIN:variables
    private javax.swing.JCheckBox backboneBox;
    private javax.swing.JButton cancelButton;
    private javax.swing.JCheckBox electricalBox;
    private javax.swing.JButton generateButton;
    private javax.swing.JCheckBox inBox;
    private javax.swing.JTextField neuronsBox;
    private javax.swing.JLabel neuronsLabel;
    private javax.swing.JCheckBox outBox;
    private javax.swing.JLabel partnerLabel;
    private javax.swing.JTextField partnersBox;
    private javax.swing.JTextField spacingBox;
    private javax.swing.JLabel spacingLabel;
    private javax.swing.ButtonGroup viewAngle;
    private javax.swing.JLabel viewLabel;
    private javax.swing.JRadioButton xzButton;
    private javax.swing.JTextField zoomBox;
    private javax.swing.JLabel zoomLabel;
    // End of variables declaration//GEN-END:variables
}
